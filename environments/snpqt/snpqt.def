Bootstrap: docker
From: ubuntu:20.04
Stage: spython-base

%post

DEBIAN_FRONTEND=noninteractive

apt-get clean && apt-get update --fix-missing && apt-get -y install unzip r-base curl libxml2-dev libcurl4-openssl-dev libssl-dev

curl https://github.com/samtools/bcftools/releases/download/1.10.2/bcftools-1.10.2.tar.bz2 \
-L -o /opt/bcftools.tar.bz2
cd /opt/ && tar -xjf bcftools.tar.bz2
cd /opt/bcftools-1.10.2/ && ./configure && make && make install

BCFTOOLS_PLUGINS=/opt/bcftools-1.10.2/plugins

R -e 'install.packages(c("cowplot", "plotly", "htmlwidgets", "qqman", "tidyverse"))'

curl http://s3.amazonaws.com/plink2-assets/alpha2/plink2_linux_avx2.zip \
--output /opt/plink2.zip
unzip /opt/plink2.zip -d /opt/plink2/
PATH="/opt/plink2:${PATH}"

curl http://s3.amazonaws.com/plink1-assets/plink_linux_x86_64_20201019.zip \
--output /opt/plink.zip
unzip /opt/plink -d /opt/plink
PATH="/opt/plink:${PATH}"

apt-get update --fix-missing && apt-get -y install samtools tabix pandoc
%environment
export DEBIAN_FRONTEND=noninteractive
export BCFTOOLS_PLUGINS=/opt/bcftools-1.10.2/plugins
export PATH="/opt/plink2:${PATH}"
export PATH="/opt/plink:${PATH}"
%runscript
exec /bin/bash "$@"
%startscript
exec /bin/bash "$@"
